---
layout: post
title: "Talking Twitter client"
date: 2009-12-29
comments: false
categories:
 - text2speech
 - festival
 - linux
 - bash
 - text-to-speech
 - desktop
 - python
 - twitter
 - hack
---

<div class='post'>
So I learnt this afternoon about this Linux utility called <a href="http://www.xenocafe.com/tutorials/php/festival_text_to_speech/index.php">festival</a>. It's a text to speech conversion program. Running it is as simple as<br /><br /><pre>echo "Hello world" | festival --tts</pre><br />Moreover, installing it on Fedora is as easy as <br /><br /><pre>sudo yum install -y festival</pre><br />After that, a bit of a bash and a bit of a python and I had a twit-to-speech utility running.<br /><br />The code is simply this much:<br /><br /><div id="main_code"><pre><span style="color: #ff6060;">#!/bin/bash</span><br /><br /><span style="color: cyan;">TWITTERURL</span>=<span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">http://twitter.com/statuses/friends_timeline.json</span><span style="color: #8080ff;"><b>"</b></span><br /><span style="color: cyan;">JSON</span>=<span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">/tmp/twittline.json</span><span style="color: #8080ff;"><b>"</b></span><br /><span style="color: cyan;">SPEECH</span>=<span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">/tmp/twt.message</span><span style="color: #8080ff;"><b>"</b></span><br /><span style="color: cyan;">PYCODE</span>=<span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">/tmp/twt2speech.py</span><span style="color: #8080ff;"><b>"</b></span><br /><br /><span style="color: #8080ff;"><b>read</b></span> <span style="color: #ff6060;"><b>-p</b></span> <span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">Username: </span><span style="color: #8080ff;"><b>"</b></span> TUSER &amp;&amp; <span style="color: #8080ff;"><b>\</b></span><br /><span style="color: #8080ff;"><b>read</b></span> <span style="color: #ff6060;"><b>-sp</b></span> <span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">Password: </span><span style="color: #8080ff;"><b>"</b></span> TPASS &amp;&amp; <span style="color: #8080ff;"><b>\</b></span><br />curl <span style="color: #ff6060;"><b>-s</b></span> <span style="color: #ff6060;"><b>-u</b></span> <span style="color: #ff40ff;">$TUSER</span>:<span style="color: #ff40ff;">$TPASS</span> <span style="color: #ff40ff;">$TWITTERURL</span> <span style="color: #8080ff;"><b>&gt;</b></span> <span style="color: #ff40ff;">$JSON</span><br /><br />cat <span style="color: #8080ff;"><b>&gt;</b></span> <span style="color: #ff40ff;">$PYCODE</span> <span style="color: #8080ff;"><b>&lt;&lt; "EOF"</b></span><br /><span style="color: lime;">import json</span><br /><span style="color: lime;">import sys</span><br /><span style="color: lime;">import re</span><br /><span style="color: lime;">urlp="(https?|ftp|file)://[-a-zA-Z0-9+&amp;@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&amp;@#/%=~_|]"</span><br /><span style="color: lime;">twits = json.load(open(sys.argv[1]))</span><br /><span style="color: lime;">for twit in twits:</span><br /><span style="color: lime;">    text = twit['user']['name']+' says: '+twit['text']</span><br /><span style="color: lime;">    text = re.sub(urlp, '', text)</span> <br /><span style="color: lime;">    print text</span><br /><span style="color: #8080ff;"><b>EOF</b></span><br /><br />python <span style="color: #ff40ff;">$PYCODE</span> <span style="color: #ff40ff;">$JSON</span> <span style="color: #8080ff;"><b>&gt;</b></span> <span style="color: #ff40ff;">$SPEECH</span><br /><br /><span style="color: #8080ff;"><b>while </b></span><span style="color: #8080ff;"><b>read</b></span><span style="color: #8080ff;"><b> line</b></span><br /><span style="color: #8080ff;"><b>do</b></span><br />notify-send <span style="color: #8080ff;"><b>-t</b></span> <span style="color: lime;">15000</span> <span style="color: #8080ff;"><b>"</b></span><span style="color: #ff40ff;">$line</span><span style="color: #8080ff;"><b>"</b></span><br /><span style="color: #8080ff;"><b>echo</b></span><span style="color: lime;"> </span><span style="color: #ff40ff;">$line</span><span style="color: lime;"> </span><span style="color: #8080ff;"><b>|</b></span> festival --tts<br /><span style="color: #8080ff;"><b>sleep</b></span> <span style="color: lime;">1</span><br /><span style="color: #8080ff;"><b>done</b></span> <span style="color: #8080ff;"><b>&lt;</b></span> <span style="color: #ff40ff;">$SPEECH</span><br /><br /><span style="color: #8080ff;"><b>echo</b></span><span style="color: lime;"> </span><span style="color: #8080ff;"><b>"</b></span><span style="color: lime;">THE END</span><span style="color: #8080ff;"><b>"</b></span><span style="color: lime;"> </span>| festival <span style="color: #ff6060;"><b>--tts</b></span><br /><br /></pre></div><div class="credits"><span style="font-size: x-small;">code syntax highlighting by </span><a href="http://vim.sourceforge.net/" name="vimhome"><span style="font-size: x-small;">GVIM</span></a> <br /></div><br />The above script will ask your twitter credentials, fetch latest 20 twits in friends' timeline, save into a JSON file. A short python script parses the JSON, extracts twit text and user's name from it and outputs in a sanitized format (it removes URLs, because there is no use hearing them).<br /><br />The sanitized output is &nbsp;saved in another text file, which is piped one line at a time to festival. In case the speech is not clear, it also shows the text in a pop-up using notify-send.<br /><br />A full script with some error checking can be found <a href="http://altcanvas.googlecode.com/files/twt2speech">here</a>.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>yomguy</div>
<div class='content'>
Sorry,<br /><br />timeline = api.GetFriendsTimeline()<br /><br />should be more interesting !<br />:-]</div>
</div>
<div class='comment'>
<div class='author'>yomguy</div>
<div class='content'>
Hi !<br /><br />Nice idea but could be much simpler using the python-twitter module :<br />http://code.google.com/p/python-twitter/<br /><br />Example :<br /><br />import os<br />import twitter<br /><br />name = &#39;me&#39;<br />pass = &#39;******&#39;<br /><br />api = twitter.Api(username=name, password=pass)<br />timeline = api.GetUserTimeline()<br />for post in timeline:<br />    os.system(&#39;echo &quot;&#39; + post.text.encode(&#39;utf8&#39;) + &#39;&quot; | festival --tts&#39;)<br /><br /><br />The last line should be indented.<br />;)</div>
</div>
<div class='comment'>
<div class='author'>Tony</div>
<div class='content'>
I increased the range to 10000 and now I&#39;m getting the original error again.  :-(</div>
</div>
<div class='comment'>
<div class='author'>Tony</div>
<div class='content'>
Okay, I made a mistake in my previous post.  The first line of the code should be uncommented and the second line commented.  Running that that way yields:<br /><br />___________________________________<br />Traceback (most recent call last):<br />  File &quot;/tmp/twt2speech.py&quot;, line 5, in <br />    twits = json.load(open(sys.argv[1]))<br />  File &quot;/usr/lib/python2.6/json/__init__.py&quot;, line 267, in load<br />    parse_constant=parse_constant, **kw)<br />  File &quot;/usr/lib/python2.6/json/__init__.py&quot;, line 307, in loads<br />    return _default_decoder.decode(s)<br />  File &quot;/usr/lib/python2.6/json/decoder.py&quot;, line 319, in decode<br />    obj, end = self.raw_decode(s, idx=_w(s, 0).end())<br />  File &quot;/usr/lib/python2.6/json/decoder.py&quot;, line 336, in raw_decode<br />    obj, end = self._scanner.iterscan(s, **kw).next()<br />  File &quot;/usr/lib/python2.6/json/scanner.py&quot;, line 55, in iterscan<br />    rval, next_pos = action(m, context)<br />  File &quot;/usr/lib/python2.6/json/decoder.py&quot;, line 183, in JSONObject<br />    value, end = iterscan(s, idx=end, context=context).next()<br />  File &quot;/usr/lib/python2.6/json/scanner.py&quot;, line 55, in iterscan<br />    rval, next_pos = action(m, context)<br />  File &quot;/usr/lib/python2.6/json/decoder.py&quot;, line 217, in JSONArray<br />    value, end = iterscan(s, idx=end, context=context).next()<br />  File &quot;/usr/lib/python2.6/json/scanner.py&quot;, line 55, in iterscan<br />    rval, next_pos = action(m, context)<br />  File &quot;/usr/lib/python2.6/json/decoder.py&quot;, line 183, in JSONObject<br />    value, end = iterscan(s, idx=end, context=context).next()<br />  File &quot;/usr/lib/python2.6/json/scanner.py&quot;, line 55, in iterscan<br />    rval, next_pos = action(m, context)<br />  File &quot;/usr/lib/python2.6/json/decoder.py&quot;, line 155, in JSONString<br />    return scanstring(match.string, match.end(), encoding, strict)<br />ValueError: Unterminated string starting at: line 1 column 942 (char 942)</div>
</div>
<div class='comment'>
<div class='author'>Tony</div>
<div class='content'>
Excellent program!  I&#39;d like to modify it to speak tweets with a search keyword, and I&#39;m getting an error.  Here is the part I modified:<br />___________________________________<br /><br />#TWITTERURL=&quot;http://search.twitter.com/search.json?q=intangible&quot;<br />TWITTERURL=&quot;http://twitter.com/statuses/friends_timeline.json&quot;<br />JSON=&quot;/tmp/twittline.json&quot;<br />SPEECH=&quot;/tmp/twt.message&quot;<br />PYCODE=&quot;/tmp/twt2speech.py&quot;<br /><br />#read -p &quot;Username: &quot; TUSER &amp;&amp; \<br />#read -sp &quot;Password: &quot; TPASS &amp;&amp; \<br />#curl -s -u $TUSER:$TPASS $TWITTERURL &gt; $JSON<br />curl -s -r 0-1000 $TWITTERURL &gt; $JSON<br />_____________________________________<br /><br />At this point, it&#39;s set to search for the keyword &quot;intangible.&quot;  I added the range of 0-1000 to prevent the Twitter download limit.  I&#39;ll probably increase the range when I get it working.  But now when I run it, I get this error:<br /><br />Traceback (most recent call last):<br />  File &quot;/tmp/twt2speech.py&quot;, line 7, in <br />    text = twit[&#39;user&#39;][&#39;name&#39;]+&#39; says: &#39;+twit[&#39;text&#39;]<br />TypeError: string indices must be integers<br /><br />Do you know what could be causing it?<br /><br />Best,<br />Tony</div>
</div>
</div>
